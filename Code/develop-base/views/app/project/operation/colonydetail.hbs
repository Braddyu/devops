<link type="text/css" rel="stylesheet" href="{{projcfg.appurl}}/static/css/page-style.css">
<div class="row">
    <div class="col-xs-12 col-md-12">
        <div class="widget">
            <div class="widget-body">
                <div class="row">
                    <div class="col-xs-12 col-md-12" style="padding-left: 5px;padding-right: 5px;">
                        <div class="widget-header bordered-bottom bordered-themeprimary">
                            <i class="widget-icon fa fa-tags themeprimary"></i>
                            <span class="widget-caption themeprimary">集群资源概览</span>
                            <div class="widget-buttons">
                                <a id="btnBack" href="javascript:void(0)">
                                    返回
                                </a>
                            </div>
                            <div class="widget-buttons">
                                <a id="btnList" href="javascript:void(0)">
                                    主机列表
                                </a>
                            </div>
                        </div><!--Widget Header-->
                        <div class="widget-body">
                            <div style="">
                                <div class="box-list-content">
                                    <div class="col-xs-6 col-md-6" style="width:100%;margin-top: 30px">
                                        <font size="3.5rem" style=""> <b>基础信息</b></font>
                                    </div>
                                    <div style="display: inline;font-size: 16px;margin-top: 20px"
                                         class="col-xs-6 col-md-6">
                                        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp名称
                                        : <span id="name"></span></div>
                                    <div class="col-xs-6 col-md-6" style="font-size: 16px;margin-top: 20px">
                                        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp位置
                                        : <span id="position"></span></div>
                                    <div class="col-xs-6 col-md-6" style="font-size: 16px;margin-top: 20px">
                                        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp管理员
                                        : <span id="user"></span></div>
                                    <div class="col-xs-6 col-md-6" style="font-size: 16px;margin-top: 20px">
                                        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp状态
                                        : <span id="status"></span></div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12 col-md-12" style="padding-left: 5px;padding-right: 5px;">
                        <div class="widget-header bordered-bottom bordered-themeprimary">
                            <i class="widget-icon fa fa-tags themeprimary"></i>
                            <span class="widget-caption themeprimary">资源使用情况</span>
                        </div><!--Widget Header-->
                        <div class="widget-body">
                            <div style="">
                                <div class="box-list-content">
                                    <table style="width: 100%;height: 200px;margin-top: 10px"
                                           class="col-xs-12 col-md-12">
                                        <tr>
                                            <td id="cpu" style="width:33%; height: 300px;"></td>
                                            <td id="neicun" style="width:33%; height: 300px;"></td>
                                            <td id="disk" style="width:33%; height: 300px;"></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12 col-md-12" style="padding-left: 5px;padding-right: 5px;">
                        <div class="widget-header bordered-bottom bordered-themeprimary">
                            <i class="widget-icon fa fa-tags themeprimary"></i>
                            <span class="widget-caption themeprimary">系统信息</span>
                        </div><!--Widget Header-->
                        <div class="widget-body">
                            <div style="">
                                <div class="box-list-content">
                                    <div id="runStatus" style="width:40%; height: 300px;margin-top: 50px;"
                                         class="col-xs-6 col-md-6"></div>
                                    <div id="ringChart" style="width:60%; height: 600px;margin-top: 50px"
                                         class="col-xs-6 col-md-6"></div>
                                    <div id="operationSystem"
                                         style="width:40%; height: 300px;margin-top: -290px;margin-left: 17px"
                                         class="col-xs-6 col-md-6"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>


                <div class="row">
                    <div class="col-xs-12 col-md-12" style="padding-left: 5px;padding-right: 5px;">
                        <div class="widget-header bordered-bottom bordered-themeprimary">
                            <i class="widget-icon fa fa-tags themeprimary"></i>
                            <span class="widget-caption themeprimary">资源使用情况</span>
                        </div><!--Widget Header-->
                        <div class="widget-body">
                            <div style="">
                                <div class="box-list-content">
                                    <table style="width: 100%;height: 1000px;margin-top: 10px"
                                           class="col-xs-12 col-md-12">
                                        <tr>
                                            <td>
                                                <div class="col-xs-6 col-md-6" style="width:100%;margin-top: 30px">
                                                    <font size="3.0rem" style=""> <b>集群拓扑图</b></font>

                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>&nbsp</td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" style="width:20%; height: 500px;"><img
                                                    src="{{projcfg.appurl}}/static/images/netWork.png"
                                                    style="width: 100%"></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
        </div>
    </div>
</div>


<script type="text/javascript" src="{{projcfg.appurl}}/static/js/echart/v3.1.3/echarts.min.js"></script>
<script type="text/javascript">
    //页面直接跳转页面带参数时，获取url参数值
    var master_ip, master_id;

    function GetRequest() {
        var values = [];
        var url = location.search; //获取url中"?"符后的字串
        if (url.indexOf('?') != -1) {    //判断是否有参数
            var str = url.substr(1); //从第一个字符开始 因为第0个是?号 获取所有除问号的所有符串
            //用等号进行分隔 （因为知道只有一个参数 所以直接用等号进分隔 如果有多个参数 要用&号分隔 再用等号进行分隔）
            if (str.indexOf('&') >= 0) {
                var strs = str.split('&');
                for (var i = 0; i < strs.length; i++) {
                    var vals = strs[i].split('=');
                    if (i == 0) {
                        values.push(decodeURI(vals[1]));
                    } else {
                        values.push(vals[1]);
                    }
                }
            } else {
                var strs = str.split('=');
                values.push(decodeURI(strs[1]));
            }
            return values;
        }
    }

    $('#btnList').click(function() {
        window.location.href = '{{projcfg.appurl}}/hostmanage?master_ip=' + encodeURI(master_ip) + '&master_id=' +
                master_id;
    });
    $('#btnBack').click(function() {
        window.location.href = '{{projcfg.appurl}}/colonym';
    });
    $(function() {
        var paramsValues = GetRequest();
        console.log('======paramsValues=====', paramsValues);
        var id = paramsValues[0];
        $.ajax({
            url: '{{projcfg.appurl}}/api/project/operation/colonymanage/' + id,
            type: 'get',
            success: function(data) {
                master_ip = data.data[0].master_ip;
                master_id = data.data[0].master_id;
                $('#name').html(data.data[0].name);
                $('#position').html(data.data[0].position);
                $('#user').html(data.data[0].createUser);
                if (data.data[0].status == 1)
                    $('#status').
                            html('<img id="u56_img" class="img " src="{{projcfg.appurl}}/static/images/u56.png">运行中');
                else
                    $('#status').
                            html('<img id="u58_img" class="img " src="{{projcfg.appurl}}/static/images/u58.png">失效');
            },
        });
        //初始化echarts实例
        var cpuChart = echarts.init(document.getElementById('cpu'));
        var memoryChart = echarts.init(document.getElementById('neicun'));
        var diskChart = echarts.init(document.getElementById('disk'));
        var runStatusChart = echarts.init(document.getElementById('runStatus'));
        var operationSystemChart = echarts.init(document.getElementById('operationSystem'));
        var ringChart = echarts.init(document.getElementById('ringChart'));
        var usedCpu, totalCpu, usedDisk, totalDisk, usedMemory, totalMemory;
        $.ajax({
            url: '{{projcfg.appurl}}/api/project/operation/colonydetail/' + id,
            type: 'post',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function(data) {
                var usedCpus = parseFloat(data.data[0].usedCpu);
                totalCpu = parseFloat(data.data[0].totalCpu);
                usedCpu = usedCpus / totalCpu * 100;
                var usedDisks = parseFloat(data.data[0].usedDisk);
                totalDisk = parseFloat(data.data[0].totalDisk);
                usedDisk = usedDisks / totalDisk * 100;
                var usedMemorys = parseFloat(data.data[0].usedMemory);
                totalMemory = parseFloat(data.data[0].totalMemory);
                usedMemory = usedMemorys / totalMemory * 100;
                cpuChart.setOption({
                    title: {
                        text: 'CPU',
                        subtext: '共计' + totalCpu + ',已使用' + usedCpus,
                        x: 'center',
                        y: 'bottom',
                    },
                    tooltip: {
                        trigger: 'item',
                        formatter: '{a} <br/>{d}%',
                    },
                    legend: {},
                    series: [
                        {
                            name: '使用情况',
                            type: 'pie',
                            radius: '60%',
                            center: ['50%', '40%'],
                            data: [
                                {value: usedCpu, name: '已使用'},
                                {value: (100 - usedCpu), name: '未使用'},
                            ],
                            itemStyle: {
                                emphasis: {
                                    shadowBlur: 20,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)',
                                },
                            },
                        },
                    ],
                });
                memoryChart.setOption({
                    title: {
                        text: '内存',
                        subtext: '共计' + (totalMemory / 1024).toFixed(3) + 'G,已使用' + (usedMemorys / 1024).toFixed(3) +
                        'G',
                        x: 'center',
                        y: 'bottom',
                    },
                    tooltip: {
                        trigger: 'item',
                        formatter: '{a} <br/>{d}%',
                    },
                    legend: {},
                    series: [
                        {
                            name: '使用情况',
                            type: 'pie',
                            radius: '60%',
                            center: ['50%', '40%'],
                            data: [
                                {value: usedMemory, name: '已使用'},
                                {value: (100 - usedMemory), name: '未使用'},
                            ],
                            itemStyle: {
                                emphasis: {
                                    shadowBlur: 20,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)',
                                },
                            },
                        },
                    ],
                });
                diskChart.setOption({
                    title: {
                        text: '磁盘',
                        subtext: '共计' + (totalDisk / 1024).toFixed(3) + 'G,已使用' + (usedDisks / 1024).toFixed(3) + 'G',
                        x: 'center',
                        y: 'bottom',
                    },
                    tooltip: {
                        trigger: 'item',
                        formatter: '{a} <br/>{d}%',
                    },
                    legend: {},
                    series: [
                        {
                            name: '使用情况',
                            type: 'pie',
                            radius: '60%',
                            center: ['50%', '40%'],
                            data: [
                                {value: usedDisk, name: '已使用'},
                                {value: (100 - usedDisk), name: '未使用'},
                            ],
                            itemStyle: {
                                emphasis: {
                                    shadowBlur: 20,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)',
                                },
                            },
                        },
                    ],
                });
            },
        });
        $.ajax({
            url: '{{projcfg.appurl}}/api/project/operation/colonydetail/getHostInfo',
            type: 'get',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function(data) {
                var xAxis = new Array();//获取主机列表
                var status = new Array();//获取运行状态使用情况
                var running = 0, stopping = 0;
                var operationSystem = new Array();//获取操作系统情况
                for (var i in data.data) {
                    xAxis.push(data.data[i].slave_ip);
                    if (data.data[i].status) {
                        running++;
                    } else {
                        stopping++;
                    }
                    if (operationSystem.indexOf(data.data[i].os) == -1) {
                        operationSystem.push(data.data[i].os);
                    }

                }
                status.push(running);
                status.push(stopping);
                runStatusChart.setOption({
                    title: {
                        text: '系统类型',
                        x: 20,
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow',
                        },
                    },
                    legend: {},
                    grid: {
                        left: '5%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true,
                    },
                    xAxis: {
                        type: 'value',
                        splitLine: {

                            show: false,

                        },
                        boundaryGap: [0, 0.01],
                    },
                    yAxis: {
                        type: 'category',
                        splitLine: {

                            show: false,

                        },
                        data: ['运行中: ' + status[0] + '台', '失效: ' + status[1] + '台'],
                    },
                    color: ['green'],
                    series: [
                        {
                            name: '数量',
                            type: 'bar',
                            data: status,
                        },
                    ],
                });
                operationSystemChart.setOption({
                    title: {
                        text: '操作系统',
                        subtext: '',
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow',
                        },
                    },
                    legend: {},
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true,
                    },
                    xAxis: {
                        type: 'value',
                        splitLine: {

                            show: false,

                        },
                        boundaryGap: [0, 1],
                    },
                    yAxis: {
                        type: 'category',
                        splitLine: {

                            show: false,

                        },
                        data: operationSystem,
                    },
                    color: ['green'],
                    series: [
                        {
                            name: '数量',
                            type: 'bar',
                            data: status,
                        },
                    ],
                });
                ringChart.setOption({
                    tooltip: {
                        trigger: 'item',
                        formatter: '{a} <br/>{b}: {c} ({d}%)',
                    },
                    legend: {},
                    series: [
                        {
                            name: '数量',
                            type: 'pie',
                            selectedMode: 'single',
                            radius: [0, '30%'],

                            label: {
                                normal: {
                                    position: 'inner',
                                },
                            },
                            labelLine: {
                                normal: {
                                    show: false,
                                },
                            },
                            data: [
                                {value: stopping, name: '失效', selected: false},
                                {value: running, name: '运行中'},
                            ],
                        },
                        {
                            name: '操作系统数量',
                            type: 'pie',
                            radius: ['40%', '55%'],
                            label: {
                                normal: {
                                    backgroundColor: '#eee',
                                    borderColor: '#aaa',
                                    borderWidth: 1,
                                    borderRadius: 4,
                                    rich: {
                                        a: {
                                            color: '#999',
                                            lineHeight: 22,
                                            align: 'center',
                                        },
                                        hr: {
                                            borderColor: '#aaa',
                                            width: '100%',
                                            borderWidth: 0.5,
                                            height: 0,
                                        },
                                        b: {
                                            fontSize: 16,
                                            lineHeight: 33,
                                        },
                                        per: {
                                            color: '#eee',
                                            backgroundColor: '#334455',
                                            padding: [2, 4],
                                            borderRadius: 2,
                                        },
                                    },
                                },
                            },
                            data: [
                                {value: 7, name: 'Linux'},
                                /*    {value:310, name:'ubuntu16'},
                                    {value:234, name:'centos6'},
                                    {value:135, name:'centos7'},
                                    {value:1048, name:'redhat5.5'}*/
                            ],
                        },
                    ],
                });
            },
        });
        // 去掉  资源使用情况时序图,网络出入时序图
//        $('#cpuStatus').
//                append('<iframe src="http://192.168.9.69:3000/dashboard-solo/db/xi-tong-xin-xi-1111?orgId=1&panelId=1&from=1506671538692&to=1506757938692&theme=light" width="100%" height="100%" frameborder="0"></iframe>');
//        $('#memoryStatus').
//                append('<iframe src="http://192.168.9.69:3000/dashboard-solo/db/xi-tong-xin-xi-1111?orgId=1&panelId=2&from=1506671677335&to=1506758077335&theme=light" width="100%" height="100%" frameborder="0"></iframe>');
//        $('#diskStatus').
//                append('<iframe src="http://192.168.9.69:3000/dashboard-solo/db/xi-tong-xin-xi-1111?orgId=1&panelId=3&from=1506671785003&to=1506758185004&theme=light" width="100%" height="100%" frameborder="0"></iframe>');
//        $('#netStatus').
//                append('<iframe src="http://192.168.9.69:3000/dashboard-solo/db/xi-tong-xin-xi-1111?orgId=1&from=1506672310786&to=1506758710787&theme=light&panelId=7" width="100%" height="100%" frameborder="0"></iframe>');

    });
</script>